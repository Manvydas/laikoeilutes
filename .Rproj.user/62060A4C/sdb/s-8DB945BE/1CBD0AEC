{
    "collab_server" : "",
    "contents" : "---\nheader-includes:\n- \\usepackage[nottoc,numbib]{tocbibind}\n- \\usepackage{dcolumn}\n- \\usepackage[utf8]{inputenc}\n- \\usepackage{capt-of}\n- \\usepackage{ucs}\n- \\usepackage[english,lithuanian]{babel}\n- \\usepackage{hyperref}\n- \\usepackage{amssymb}\n- \\usepackage{theorem}\n- \\usepackage{bm}\n- \\usepackage{graphicx}\n- \\usepackage{lmodern}\n- \\pagestyle{plain}\n- \\usepackage{setspace}\n- \\linespread{1.5}\noutput:\n  pdf_document:\n    latex_engine: xelatex\n    number_section: yes\n    toc_depth: 2\n  html_document: default\n---\n\n```{r, message=FALSE, echo=FALSE, include=F}\nlibrary(\"quantmod\")\nlibrary(\"forecast\")\nlibrary(\"xts\")\nlibrary(\"dplyr\")\nlibrary(\"gridExtra\")\nlibrary(\"ggplot2\")\nlibrary(\"reshape2\")\nlibrary(\"knitr\")\nlibrary(\"tseries\")\nlibrary(\"sandwich\")\nlibrary(\"lmtest\")\nlibrary(\"MASS\")\nlibrary(\"car\")\nSys.setlocale(locale=\"en_US.UTF-8\")\nlibrary(\"extrafont\")\nloadfonts()\nlibrary(\"pander\")\npanderOptions('decimal.mark', ',')\n```\n\n\\begin{titlepage}\n\n\\centerline{\\bf \\large VILNIAUS UNIVERSITETAS}\n\\bigskip\n\\centerline{\\large \\textbf{MATEMATIKOS IR INFORMATIKOS FAKULTETAS}}\n\n\\vskip 120pt\n\\centerline{\\bf \\large \\textbf{Kursinis darbas}}\n\\vskip 50pt\n\\begin{center}\n    {\\bf \\LARGE Lietuvos akcijų rinkos grąžos priklausomybė nuo makroekonominių duomenų}\n\\end{center}\n\\vskip 30pt\n\\centerline{\\large \\textbf{Darbą atliko: Manvydas Sokolovas ir Paulius Kostickis}}\n\\bigskip\n\\centerline{\\large \\textbf{Kursinio vadovas: lekt. dr. Dmitrij Celov}}\n\\vskip 90pt\n\\vskip 160pt\n\\centerline{\\large \\textbf{VILNIUS 2016}}\n%\\newpage\n\\end{titlepage}\n\n\\textwidth 6.5in\n\\textheight 9.00in\n\n\\begin{titlepage}\n\\centerline {\\bf \\large MATEMATIKOS IR INFORMATIKOS FAKULTETAS}\n\\vskip 10pt\n\\centerline {\\bf EKONOMETRINĖS ANALIZĖS KATEDRA}\n\n\\vskip 120pt\n\\large Darbo vadovas lekt. dr. Dmitrij Celov \\underline{\\hskip 95pt} \n\n\\large Darbo vadovo įvertinimas  \\underline{\\hskip 94pt} \n\\vskip 150pt\n\n\n\\large Darbas apgintas \\underline{\\hskip 94pt }\n\n\\large Darbas įvertintas \\underline{\\hskip 94pt }\n\n\\vskip 140pt\n\n{\\large Registravimo NR. \\underline{\\hskip 94pt }\n\nAtidavimo į Katedrą data \\underline{\\hskip 94pt} }\n\\end{titlepage}\n\\textwidth 6.5in\n\\textheight 9.00in\n\n\\section*{Santrauka}\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Makroekonomiai rodikliai gali padėti nuspėti ateities verslo ciklą, kuris turi įtakos akcijų pelningumui. Naudojant Lietuvos makroekonominius duomenis, matuojamos  rizikos premijos, kurios gaunamos už riziką investuojant Lietuvos rinkoje. Šie duomenys iliustruoja Lietuvos ekonominę būklę.  Sudarytas „OMX Vilnius“ indekso grąžos įkainojimo ir prognozavimo modelis remiantis arbitražo įkainojimo teoremą (angl. APT) siekiant išsiaiškinti, kurie Lietuvos makroekonominiai rodikliai veikia „OMX Vilnius“ indekso grąžas. Sukurta prekybos strategija naudojant sukurtą prognozavimo modelį. Strategija palyginta su atsitiktiniu investavimu. Tirti mėnesiniai duomenys nuo 2002 iki 2016 metų. Dalis makroekonominių rodiklių yra reikšmingi vertinant indekso kainos pokyčius. Jų reikšmingumas tirtas dvigubos atrankos metodu. Sukurta strategija ir prognozavimo modelis padeda geriau investuoti lyginant su atsitiktiniu investavimu.\n\n\\newpage\n\\tableofcontents\n\\newpage\n\n# Įvadas\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Akcijų pokyčiams yra reikšminga ekonomikos būsena. Ekonominis ciklas turi tendenciją kilti, tačiau jos plėtra vyksta tai sparčiau, tai lėčiau ir galimas nuosmukis. Jei ekonomika auga, tuomet dauguma įmonių padidina savo pelną ir gamybą. Priešingas procesas, kai ekonomika traukiasi. Egzistuoja makroekonominiai rodikliai tokie kaip infliacija, valiutos kursas, palūkanų dydis, kurie padeda įvertinti ekonominę būklę, kuri yra svarbi pelningumui iš aktyvų. Todėl galima būtų manyti, jog makroekonominiai rodikliai koreliuoja su aktyvų grąžomis. Tačiau markoekonominių rodiklių poveikis akcijų rinkoms yra nevienareikšmis. Pavyzdžiui, yra atliktas tyrimas Rusijos rinkoje\\cite{rusija}, remiantis arbitražo įkainojimo teorija, kurio tyrimo autorius nesugebėjo rasti reikšmingos makroekonominių duomenų  įtakos akcijų grąžoms. O Šri Lankos\\cite{sri_lanka} ir Indijos\\cite{indija} rinkoms atlikti empiriniai tyrimai parodė, jog makroekonominiai rodikliai turi įtakos akcijų grąžai. Todėl nutarta ištirti Lietuvos akcijų rinkos grąžos priklausomybę nuo makroekonominių rodiklių remiantis arbitražo įkainojimo teorija (angl. APT) iš daugelių rodiklių atrinkti svarbiausius. \n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Kylančiose rinkose daug dažniau pasitaiko neteisingai įkainotų finansinių instrumentų nei išvystytose (efektyviose) rinkose. Lietuvos rinką galime priskirti besivystančiosios rinkos kategorijai ir galbūt tyrimo išvadas, naudojant APT, galima bus praktiškai pritaikyti pelningiau investuojant. Todėl kurtas prognozuojantis modelis su investavimo(tiksliau spekuliavimo) strategija ir ji palyginta su atsitiktinu investavimu.\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pirmoje dalyje bus pateikta rizikos ir diversifikavimo svarba ir šio tyrimo matuojamas objektas - rizikos premijos. Vėliau aptariamas aktyvų įkainojimo modelis (CAPM) ir arbitražinė aktyvų įkainojimo teorija (APT) bei jų pritaikymas tyrime. Kadangi jų prielaidos mažai realistiškos, darbe bus sukurtos ir naudojamos kitos prielaidos, tačiau jos sukurtos remiantis diversifikavimo teorija, CAPM ir APT.  Kitoje dalyje sudaromas įkainojimo modelis ir tikrinamas rodiklių reikšmingumas naudojant dvigubos atrankos metodologiją. Vėliau kuriamas prognozuojantis modelis, kuriuo bus bandoma nuspėti kito mėnesio OMX Vilniaus indekso grąžą ir naudojantis sukurta strategija lyginama su atsitiktiniu investavimo rezultatais, atsitiktinį investavimą simuliuojant Monte Carlo metodu. \n\\newpage\n\n# Aktyvų įkainojimas\n\n## Rizika ir diversifikavimas\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Investuojant į akcijas, kuo didesnis standartinis nuokrypis, tuo didesnė galimybė prarasti investuotus pinigus. Investicijų kontekste rizika bus matuojama variacija. Taigi rizika ir pajamos iš investicijų yra tiesiogiai tarpusavyje susijusios: kuo didesnė rizika, tuo turėtų būti didesnės laukiamas pelnas iš investicijų, kad jos kompensuotų aukštą rizikos lygį. Priimant investicinį sprendimą svarbus tampa reikalaujamas pelningumas – tai mažiausias laukiamas pelnas, kurio yra reikalaujama už investavimą į rizikingą aktyvą. Investuotojas gali rinktis nerizikingą pelną, pirkdamas nerizikingus vertybinius popierius. Ši nerizikinga pelno norma yra minimumas, kurio gali tikėtis investuotojas neprisiimdamas jokios rizikos. Pirkdamas rizikingesnį vertybinį popierių, investuotojas reikalaus rizikos premijos (atpildo už rizikingų vertybinių popierių laikymą). Taigi nerizikinga pelno norma bei rizikos premija sudaro reikalaujamą pelningumą. Ši priklausomybė pavaizduota 1 pav..\n\n![](lentele3.png)\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Investiciniams sprendimas priimti esant neapibrėžtumui H. Markowitz pasiūlė portfelio teorija, leidžiančia investuotojams įvertinti riziką ir laukiamas pajamas. Galimą riziką sumažinti, o pelną padidinti, jei bus investuojama į skirtingas įmones, kurių akcijų kainos juda skirtingomis kryptimis. Diversifikacija eliminuoja nesisteminę riziką dėl dviejų priežasčių: atskiros įmonės akcijos sudaro nedidelę dalį portfelyje, todėl poveikis (tiek teigiamas, tiek neigiamas) mažai juntamas. Darbe remiamasi prielaida, jog galime diversifikuoti nesisteminę riziką, todėl bus tiriama tik sisteminės rizikos teikiamas premijas. \n\n## Aktyvų įkainojimo modelis (CAPM)\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Remiantis H. Markowitz sukurta portfelio teorija, buvo pasiūlytas teorinis aktyvų įkainojimo modelis (angl. CAPM). Vienas iš šio modelio kūrėjų William Sharpe ir H. Markowitz gavo Nobelio premiją 1990 m. Šis modelis yra svarbus tuo, jog yra pirmasis modelis, kuris turi aiškų pagrindimą, galima empiriškai testuoti ryšį tarp laukiamo pelno ir rizikos konkurencinėje rinkoje. Pažymėtina, kad šio modelio prielaidos yra labai griežtos, dažnai neatitinkančios realaus gyvenimo. Nepaisant to, vis tiek bandoma testuoti modelį su realiais duomenimis ir galima įvertinti apytikslę sisteminės rizikos premiją remiantis praeities duomenimis. CAPM nedviprasmiškai tvirtina, kad vertybinio popieriaus kovariacija su rinkos portfeliu – vienintelis\ntikras investicinės rizikos šaltinis gerai diversifikuotam portfeliui.\nJos formulė:\n\n$$E(Y) - rf = \\beta X,$$\n\nčia E(*Y*) - vidutinė akcijos grąža,\n\n*rf* - nerizikingo aktyvo grąža,\n\n(E(*Y*) - *rf*) - premija už sisteminę riziką,\n\n$\\beta$ - aktyvo rizikingumo jautrumas, \n\n*X* - visos rinkos grąža.\n\nPagal CAPM, akcijos tikėtinos grąžos premija priklauso nuo rinkos rezultatų ir specifinės sisteminės rizikos nuo rinkos jautrumo dydžio.Prielaidos yra tokios:\n\n1) visi investuotojai vengia rizikos, kuri lygi portfelio pajamų (pelno) normos vidutiniam kvadratiniam nuokrypiui;\n\n2) visi investuotojai turi vienodą laiko horizontą (pvz., vienas mėnuo, dveji metai) investiciniam sprendimui priimti;\n\n3) visi investuotojai turi vienodą subjektyvų įvertį apie būsimą kiekvieną vertybinio popieriaus pelną ir riziką;\n\n4) rinkoje egzistuoja nerizikingoji investicija į turtą, ir kiekvienas investuotojas gali skolintis arba skolinti neribotą jo kiekį su nerizikingąja palūkanų norma;\n5) į visus vertybinius popierius kapitalą galima investuoti norimu santykiu, nėra išlaidų už sandorius, mokesčių bei apribojimų nepadengtajam pardavimui;\n\n6) laisvai prieinama ir vienodai galima informacija apie investicijas visiems investuotojams;\n\n7) kapitalo rinkos yra pusiausvyroje.\n\nIš šių prielaidų seka, jog kiekvienas investuotojas turi po mažą dalį visos rinkos ir tam tikrą nerizikingo aktyvo kiekį savo portfelyje, o nerizikingų aktyvo svoris portfelyje nustatomas pagal investuotojų norimą rizikos prisiėmimo kiekį.Teorijos naudojimas ir jos interpretacija aptariama pasitelkiant 2 pav.:\n\n![](CAPM.png)\n\nTaške RF rizikos laipsnis lygus 0. Jei vertybinis popierius yra virš vertybinių popierių rinkos tiesės SML (taškas A), tai reiškia, kad jis nuvertintas, t.y. jis turėtų kainuoti daugiau už tokią teikiamą sisteminę riziką. Šis aktyvas yra patrauklesnis rizikos ir pelno atžvilgiu, todėl pakilus šios akcijos pirkimams ir sumažėjus jo pardavimams akcijos kaina turėtų kilti ir susilyginti su SML tiese. Ir atvirkščiai, jei vertybinis popierius yra žemiau SML, tai reiškia, kad jis pervertinamas (taškas B), t.y. akcijos kaina yra per didelė su jos teikiama rizika, todėl investuotojai ją turėtų parduoti ir , kainai mažėjant, rizkikos ir pelno santykis turėtų susilyginti su SML tiese. Nors pagal teorija tokios situacijos neturėtų kilti (kad A taškas yra aukščiau SML tiesės ir pan.), virš SML esančius aktyvus galėtume pirkti, nes jie yra pervertinti. Šiuo principu remsimės ir šiame darbe: bandysime įkainoti kito mėnesio aktyvą ir jei prognozuojama grąža yra didelė, bus perkamos OMX Vilnius indekso pozicijos ir bus tikimasi uždirbti. Tačiau modelis sudaroma bus pagal Arbitražinė aktyvų įkainojimo teoriją, kuri bus aptarta vėliau. Jos interpretacijos negalima paaiškinti Dekarto koordinačių sistema, nes egzistuoja daugiau rizikos faktorių.\n\nCAPM atveju beta(rizikos veiksnys) yra pasirenkamas tos pačios rinkos indeksas, nes rinkos indeksas reprezentuoja visos rinkos portfelį, kurį turėtų būti optimalu pirkti. Kaip minėta anksčiau, prielaidos nėra realistiškos, tačiau ši teorija svarbi interpretuojant riziką, akcijų pelningumą.\n\n## Arbitražinė aktyvų įkainojimo teorija (APT)\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Kadangi yra tiriamas rizikingumas investuojant Lietuvos rinkoje naudojant makroekonominius duomenis, rizikos veiksnių bus ne vienas kaip CAPM atveju, o daugiau. Tačiau CAPM yra svarbus tuo, kad jo pagrindu buvo kuriami ir tobulinami kiti aktyvų įkainojimo modeliai, kurie galėjo turėti mažiau apribojimų ir prielaidų, taip pat turėti ir daugiau darančių įtaką rodiklių. \n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Vienas iš patobulintų CAPM yra arbitražinė aktyvų įkainojimo teorija(angl. APT).  1966 m. atsirado pirmosios arbitražo įkainojimo teorijos idėjos, kai B. F. King (1966) pradėjo finansinių aktyvų grąžos pokyčius aiškinti ekonominiais duomenimis. Tačiau APT teorijos kūrėju yra laikomas S. A. Ross (1976), kuris pateikė  teorijai reikiamas prielaidas ir matematiškai pagrindė šią teoriją. Teorijos pagrindas yra panašus, kaip ir CAPM, t. y. investuotojai reikalauja rizikos premijos už nediversifikuotos (sisteminės) rizikos prisisėmimą. Tačiau norint praktiškai pritaikyti APT, reikia: apibrėžti veiksnius, įvertinti tų veiksnių įtaką portfeliui, įvertinti veiksnių premiją. APT neatsako į klausimus apie veiksnių gausumą ir svarbumą, į kuriuos turi būti atsižvelgta vertinant laukiamas pajamas. Dažniausiai išskiriama nuo 3 iki 5 tokių\nveiksnių. Jos formulė:\n\n$$E(Y) - rf = {\\beta}_0 + {X} {\\beta}_1 + {Z}_1 {\\beta}_2 + ... + {Z}_n {\\beta}_{n+1},$$\n\nčia E(*Y*) - vidutinė akcijos grąža,\n\n*rf* - nerizikingo aktyvo grąža,\n\n(E(*Y*) - *rf*) - premija už sistemines rizikas,\n\n$\\beta$ - aktyvų rizikingumo jautrumas tam tikriems rodikliams,\n\n*X* - rinkos grąža\n\n*Z* - makroekonominiai veiksniai.\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Šis aktyvų įkainojimo modelis yra grindžiamas tuo, jog aktyvo premijinį pelningumą galima numatyti naudojant analizuojamo aktyvo ir daugelio įprastų rizikos veiksnių tarpusavio ryšį. Nenurodoma kurie būtent veiksniai yra svarbūs rizikos premijai, tačiau sukurta S. Ross (1976) arbitražo įkainojimo teorija numato ryšį tarp portfelio pelningumo pasitelkiant daugelio nepriklausomų kintamųjų (makroekonominių veiksnių, tokių kaip infliacija, ekonomikos augimas, tarptautinės gamybos apimtis, palūkanų normos ir t.t.) tiesinį derinį. Darbe bus tiriamas įvairių makroekonominių rodiklių reikšmingumas grąžoms ir gebėjimas prognozuoti grąžas remiantis praeities duomenimis. Taigi, pasitelkiant šią įkainojimo teoriją, bus siekiama pasipelnyti iš gerai įvertintos kito mėnesio OMX Vilniaus indekso grąžos indeksą perkant arba skolinantis ir parduodant (angl. short sell) OMX Vilniaus indeksą, jei numatomas kito mėnesio neigiama grąža.\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Taip pat APT prielaidos yra paprastesnės už CAPM, tačiau vis tiek yra ginčytinos ir negalime teigti, jog realistiškos. \n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; APT taikymo prielaidos:\n\n1) finansų rinkos apibūdinamos kaip tobulos ir efektyvios;\n\n2) apibrėžtumo atveju investuotojai visada teiks pirmenybę didesnio pelningumo portfeliui;\n\n3) egzistuoja tam tikros svarbios sisteminės rizikos, kurios tiesiškai veikia aktyvų pelningumą, t. y. aktyvų pelningumus generuojantį stochastinį procesą galima išreikšti kaip n rizikos faktorių ar indeksų tiesinę kombinaciją. Be to, investuotojai tas rizikas suvokia ir gali įvertinti aktyvo jautrumą toms rizikoms;\n\n4) ekonomikoje yra agresyvių investuotojų, kurie išnaudos aktyvų numatomų pelningumų skirtumus pasinaudodami arbitražu.\n\n![](pav.png)\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Interpretuodami APT modelį grafiškai (3 pav.) pastebėsime, kad juoda  tiesė B yra S&P 500  indekso vertybinių popierių rinkos tiesė (SML), taškas A yra portfelis, kuris yra aukščiau tiesės. Kai rinka pasiekusi pusiausvyrą, remiantis CAPM tokia situacija neįmanoma, nes galimas tik vienas visiems prieinamas optimalus portfelis. Tačiau pavaizduota situacija yra praktiškai galima. Pagal APT tokia situacija galima, kai yra daugiau rizikos veiksnių nei įskaičiuota modelyje.\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Taigi investuotojai pasitelkia šią įkainojimo teoriją, siekdami pasipelnyti iš neteisingai įvertintų, dažniausiai nepakankamai įvertintų, aktyvų. Tačiau neteisingai įkainoto aktyvo kaina skirsis nuo tos, kuri nustatoma šio modelio dėka. Tokiu būdu investuotojai, norintys pasinaudoti arbitražu ir gauti faktiškai nerizikingą pelną, sieks palaikyti trumpas pervertinto aktyvo pozicijas ir kartu laikyti ilgas portfelio, kurio pagrindu yra atliekami APT skaičiavimai, pozicijas.\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Jei APT prielaidos patenkinamos, tuomet laukiami pelningumai bus išsidėstę arti SML, o aktyvas turės tiek rizikos charakteristikų, kiek yra veiksnių. APT teorijos prielaidos yra artimesnės realybei negu CAPM, nes ne visi investuotojai elgiasi vienodai rinkoje, net jei jų elgsena grindžiama racionalumu, t. y. APT nereikalauja CAPM prielaidų tenkinimo dėl investuotojų naudingumo funkcijų. Be to, ne kiekvienas investuotojas yra linkęs turėti rinkos portfelį kaip vienintelę alternatyvą, t. y. APT nereikalauja CAPM prielaidos tenkinimo dėl rinkos portfelio savybių, kad jis apima visus rizikingus aktyvus ir yra efektyvus vidurkio-dispersijos prasme.\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Naudojant Lietuvos makroekonominius duomenis, matuojama  rizikos premijos, kurios gaunamos už riziką investuojant Lietuvos rinkoje. Makroekonominiai duomenys iliustruoja Lietuvos ekonominę būklę. \n\n\\newpage\n\n# Duomenų transformacijos\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OMX Vilnius indeksas transformuojamas į mėnesinius procentinius pokyčius: $$r(t) = \\log{X(t)}-\\log{X(t-1)} ,$$\nčia *X(t)* - OMX indekso mėnesinė kaina nuo laiko (mėnesio) t, *r(t)* yra indekso mėnesinis pokytis procentais.\nTokiu pačiu būdu gaunama kitų akcijų indeksų grąža logaritmuojant ir imant pokyčius  S&P350 Europe indeksų kainas, kasybos ir karjerų eksploatacijos, mažmeninės prekybos, industrinės produkcijos indeksus. Euribor buvo pateiktas metinėmis palūkanomis, transformuojami į mėnesines palūkanas. Dolerio/euro valiutų kursas, pasitikėjimo ir lūkesčių rodikliai yra imami mėnesiniai pokyčiai.\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Tikrinami duomenys po transformacijų ar turi vienetinę šaknį (stacionarumo tikrinimas), atliekamas Dickey-Fuller testas. Rezultatai pateikti 1 lentelėje.\n```{r, message=FALSE, echo=FALSE, options(OutDec= \",\") }\ndata=read.csv(\"rawdata.csv\")\n\ndata[ data == \":\" ] = NA\ndata=data[complete.cases(data),]\nrownames(data)<-NULL\n```\n```{r, message=FALSE, echo=FALSE,warning =FALSE}\ndata2=apply(data[,-1],2,as.numeric)\nrownames(data2)=data[,1]\ndata2=data.frame(data2)\ndata2$nedarbas=data2$nedarbas/10\n\ndata2[,c(\"OMX\",\"SP350\",\"SP500\",\"kk\",\"mp\",\"ip\")] = apply(data2[,c(\"OMX\",\"SP350\",\"SP500\",\"kk\",\"mp\",\"ip\")],2,log)    #logaritmuojama indeksai, akcijų kainos, kursas  \n\n\ndata2$euribor=((data2$euribor+1)^(1/12)-1)*12/100 \nnames(data2)[names(data2) == 'euribor'] <- 'palukanos'\n\ndata3=data.frame(diff(as.matrix(data2)))  \ndata3$gkl = data$gkl[-1]    #gamintoju kainu lygio nereik diferencijuot nes jau yra pokytis %\ndata3[,c(\"dll\",\"nedarbas\",\"infliacija\",\"mhope\",\"phope\",\"pramhope\",\"shope\",\"ta\",\"ul\",\"vhope\",\"vp\",\"gkl\")]=data3[,c(\"dll\",\"nedarbas\",\"infliacija\",\"mhope\",\"phope\",\"pramhope\",\"shope\",\"ta\",\"ul\",\"vhope\",\"vp\",\"gkl\")]/100\n#tsdisplay(data3$infliacija)\n\np=apply(data3[,],2,function(i)adf.test(i,k=1)$p.value)\np=data.frame(p)\np[,1] = round(p[,1], digits = 2)\np=t(p)\np=data.frame(p)\nkable(p[,1:10])\nkable(p[,11:20], caption=\"Vienetinės šaknies hipotezių tikrinimas\")\ndata3$OMX=data3$OMX-data3$palukanos\ndata3$SP350=data3$SP350-data3$palukanos\ndata3$SP500=data3$SP500-data3$palukanos\n```\n```{r, message=FALSE, echo=FALSE}\nData = rownames(data3)\nData=as.yearmon(Data, \"%YM%m\")\n\ndata3=cbind.data.frame(Data, data3)\n```\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Visų kintamųjų, išskyrus infliaciją, p - reikšmė mažiau už 0.05, galime atmesti H0, kad turi vienetinę šaknį. Visi kintamieji, išskyrus infliaciją, yra stacionarūs. Reiškia visus duomenys, išskyrus infliaciją, galima naudoti tyrime.\n\n\\newpage\n\n# Makroekonominių rodiklių reikšmingumas \n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Šioje darbo dalyje tiriamas makroekonominių duomenų statistinis reikšmingumas. Remiamasi anksčiau aptarta teorija, tačiau su pakitusiomis prielaidomis. Manoma, kad CAPM ir APT prielaidos nėra realistiškos. Taip pat manoma, jog griežčiausia efektyviosios rinkos hipotezė negalioja, jog vis dėlto yra viešai prieinama informacija (makroekonominiai duomenys), kuri padeda pelningiau investuoti. Tačiau remiames teorijų išvadomis apie rinkų dėsningumus. Diversifikavus portfelį lieka tik sisteminė rizika, už kurią gauname rizikos premiją. Sudarytas portfelis iš OMX Vilniaus indekso yra gan neblogai diversifikuotas, turintis dešimtis skirtingų akcijų, todėl bus manoma, jog lieka tik sisteminės rizikos. O sisteminė rizika nusako kokio dydžio turi būti premijinė grąža, t. y. kuo didesnė sisteminė rizika, tuo didesnio pelno turėtume laukti. Nustatant rizikos veiksnius vadovaujamasi CAPM ir APT logika, jog reikia įtraukti didesnės rinkos poveikį portfeliui ir makroekonominius duomenis, o jų priklausomybė su premijine portfelio grąža turėtų būti tiesinė. Todėl į prognozavimo ir reikšmingumo modelį įtraukiamas S&P 350 Europe indeksas kaip veiksnys paaškinantis portfelio, sudaryto iš OMX Vilniaus indekso, premijines grąžas, nes Europos rinką galime teigti, jog reprezentuoja S&P 350 Europe, Lietuvos rinka priklausoma nuo Europos rinkos. Tai darbo prielaidos yra tokios:\n\n1) portfelis, sudarytas pagal OMX Vilnius indeksą, yra pakankamai diversifikuotas ir egzistuoja tik sisteminės rizikos premijos;\n\n2) rinkos nėra visada pusiausvyroje ir viešai prieinama informacija padeda prognozuoti OMX Vilniaus indekso grąžas;\n\n3) portfelio, sudaryto iš OMX Vilnius indekso, premijinės grąžos yra tiesiškai priklausomos nuo pavėlintų makroekonominių rodiklių.\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Nors, pagal APT, sisteminę riziką gali paaškinti makroekonominiai rodikliai, tačiau APT neapibrėžia kurie rodikliai yra tikrai reikšmingi. Todėl kuriant reikšmingumo ir prognozavimo modelius, bus tiriami 17 makroekonominių rodiklių. Visi rodikliai sudėti į modelį ir atmetami pagal žingsninę regresiją minimizuojant Akaike kriterijų (stepAIC). Reikšmingumas tiriamas naudojant dvigubos atrankos (double selection) metodą pagal stepAIC. Pavėlinti rodikliai galbūt gali geriau paaškinti premijinę grąžą, tad rodiklių pavėlinimas nustatomas pagal didžiausią kryžminę koreliaciją. Pradinis ekonometrinis modelis:\n\n${OMX}_t - {rf}_t = {\\beta}_0 + {SP350}_t {\\beta}_1 + \\textit{kasyba ir karjerų eksploatacija}_{t-1} {\\beta}_2 + \\textit{darbo lygio lūkesčiai}_{t-1} {\\beta}_3 + \\textit{nedarbas}_t {\\beta}_4 + \\textit{mažmeninės prekybos pasitikėjimas}_{t-3} {\\beta}_5 + \\textit{paslaugų sektoriaus pasitikėjimas}_{t-12} {\\beta}_6 + \\textit{pramonės pasitikėjimas}_t {\\beta}_7 + \\textit{statybų pasitikėjimas}_{t-1} {\\beta}_8 + \\textit{užsakymų lūkesčiai}_{t-10} {\\beta}_9 + \\textit{vartotojų pasitikėjimas}_{t-4} {\\beta}_{10} + \\textit{verslo plėtros aktyvumas}_t {\\beta}_{11} + \\textit{mažmeninė prekyba}_{t-1} {\\beta}_{12} + \\textit{gamintojų kainų lygis}_{t-9} {\\beta}_{13} + \\textit{industrinė produkcija}_{t-4} {\\beta}_{14} + \\textit{EUR/DOL kursas}_{t-2} {\\beta}_{15} + {u}_t$\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Pagal žingsninę regresiją minimizuojančia Akaike kriterijų atrinkti reikšmingi kintamieji. Į kintamųjų reikšmingumus žiūrima liberaliau. Didinami jie, kad minimizuoti sisteminės klaidos tikimybę. Tada ekonometrinis modelis yra toks:\n\n${OMX}_t - {rf}_t = {\\beta}_0 + {SP350}_t {\\beta}_1 + \\textit{mažmeninės prekybos pasitikėjimas}_{t-3} {\\beta}_2 + \\textit{paslaugų sektoriaus pasitikėjimas}_{t-12} {\\beta}_3 + \\textit{pramonės pasitikėjimas}_t {\\beta}_4 + \\textit{užsakymų lūkesčiai}_{t-10} {\\beta}_5 + \\textit{mažmeninė prekyba}_{t-1} {\\beta}_6 + \\textit{gamintojų kainų lygis}_{t-9} {\\beta}_7 + \\textit{EUR/DOL kursas}_{t-2} {\\beta}_8 + {u}_t$\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Atliktas paklaidų homoskedastiškumo testas - paklaidų homoskedastiškumo prielaida pažeista - paklaidų dispersija nėra konstanta. Tai gali iškreipti modelio statistines išvadas, todėl taikoma stabilizuotų liekamųjų paklaidų regresija. Pritaikyta HC3 pataisa. Rezultatai pateikti 3 lentelėje.\n\n```{r, message=FALSE, echo=FALSE, results='asis'}\nmodelis=lm(OMX ~ SP350  + lag(mhope, 3) + lag(phope,12) + lag(pramhope,0) + lag(ul,10) + lag(mp,1) + lag(gkl, 9) + lag(kursas,2),data=data3) \npander::pander(coeftest(modelis, vcov=vcovHC(modelis,type=\"HC3\"))[,], split.cell = 80, split.table = Inf, caption=\"Regresijos rezultatai\")\nr2<-kable(summary(modelis)[9])\n```\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Didelė dalis turimų makroekonominių duomenų yra nereikšmingi, tačiau keletas kietų ir minkštų makroekonominių rodiklių reikšmingai veikia OMX Vilnius grąžas. Modelis paaiškina apie 40 procentų OMX Vilnius indekso grąžos pokyčių. \n\n# Dvigubos atrankos metodas\n\n## Teorija\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Sprendimas kuriuos kintamuosius įtraukti, o kuriuos atmesti yra ypač svarbus. Neįtraukus kintamųjų, kurie reikšmingai veikia priklausomą kintamąjį ir koreliuoja bent su vienu nepriklausomu kintamuoju, modelio parametrų skirstiniai gali būti paslinkti ir modelis netikslus. Todėl tikslinga atlikti dvigubos atrankos metodą, kuris padeda tiksliau apskaičiuoti kintamųjų reikšmingumus bei įvertinti juos. Tikslas išsiaiškinti ar pirminė atranka įtraukė tik reikšmingus kintamuosius. Pagalbinių regresijų tikslas įvertinti modelio parametrų poslinkius.\n\n\\underline{1 žingsnis:} Sudarytas modelis iš visų turimų kintamųjų. Ankstiniai atrinkti pagal didžiausią kryžminę koreliaciją. Pirminiam modeliui taikant žingsninę regresiją pagal mažiausią Akaike kriterijaus reikšmę atrinkti reikšmingi kintamieji, sudarytas modelis:\n\n$$Y_t = \\beta_0 + \\beta_{1}X_{t1} + ... + \\beta_{8}X_{t8} + u_t;$$\n$$Z := \\beta_{1}X_{t1} + ... + \\beta_{8}X_{t8}.$$\n\n\\underline{2 žingsnis:} Sudaroma regresija vieno iš pirmame žingsnyje atrinkto reikšmingo kintamojo nuo visų turimų kintamųjų. Šiam modeliui taikant žingsninę regresiją pagal mažiausią Akaike kriterijaus reikšmę atrinkti reikšmingi kintamieji, sudarytas testuojamo kintamojo modelis:\n\n$$X_t = \\alpha_0 + \\alpha_{1}X_{t1} + ... + \\alpha_{n}X_{tn} + u_t;$$\n$$K := \\alpha_{1}X_{t1} + ... + \\alpha_{n}X_{tn}.$$\n\n\\underline{3 žingsnis:} Sudarytas modelis iš 1 ir 2 žingsniuose atrinktų kintamųjų sąjungos:\n\n$$Y_t = \\beta_0 + Z\\cup K + u_t.$$\n\nTiriami atskirų kintamųjų reikšmingumai. Todėl 2 ir 3 žingniai kartojami visiems 1 žingsnyje atrinktiems regresoriams.\n\n## Taikymas\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Šioje skiltyje bus atliktas dvigubos atrankos metodo taikymas Lietuvos akcijų rinkos grąžos priklausomybės nuo makroekonominių duomenų regresijai. Sudarius OMX Vilnius grąžų nuo visų turimų Lietuvos makroekonominių rodiklių regresiją, pirmame žingsnyje atrinktas modelis: \\newline${OMX}_t - {rf}_t = {\\beta}_0 + {SP350}_t {\\beta}_1 + \\textit{mažmeninės prekybos pasitikėjimas}_{t-3} {\\beta}_2 + \\textit{paslaugų sektoriaus pasitikėjimas}_{t-12} {\\beta}_3 + \\textit{pramonės pasitikėjimas}_t {\\beta}_4 + \\textit{užsakymo lūkesčiai}_{t-10} {\\beta}_5 + \\textit{mažmeninė prekyba}_{t-1} {\\beta}_6 + \\textit{gamintojų kainų lygis}_{t-9} {\\beta}_7 + \\textit{EUR/DOL kursas}_{t-2} {\\beta}_8 + {u}_t$.\n\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Antras ir trečias žingsniai kartojami visiems reikšmingiems kintamiesiems. Gauti pataisyti įvertiniai ir jų reikšmingumai. Rezultatai pateikti 4 lentelėje.\n```{r, message=FALSE, echo=FALSE, warning=F}\nB <- matrix(c(0.0001, 0.0001, 0.536, 0.563,\n              0.062, 0.036, 0.188, 0.316,\n              0.222, 0.048, 0.106, 0.176,\n              0.060, 0.022, 0.241, 0.266,\n              0.064, 0.079, 0.044, 0.049,\n              0.063, 0.035, 0.103, 0.114,\n              0.001, 0.009, -1.569, -1.421,\n              0.006, 0.032, 0.346, 0.278), nrow=8, ncol=4, byrow = T)\nrownames(B) <- c(\"SP350\", \"Mažmeninės prekybos pasitikėjimas\", \"Paslaugų pasitikėjimas\", \"Pramonės pasitikėjimas\", \"Užsakymų lūkesčiai\", \"Mažmeninė prekyba\", \"Gamintojų kainų lygis\", \"EUR/DOL\")\ncolnames(B) <- c(\"p-value pradiniame modelyje\", \"p-value po korekcijos\", \"koeficientas pradiniame modelyje\", \"koeficientas po korekcijos\")\n\npander::pander(B, split.cell = 80, split.table = Inf, caption=\"Dviguba atranka\")\n```\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dvigubos atrankos metodu tikrinama ar pirmame žingsnyje nebuvo praleista kintamųjų reikšmingai veikiančių regresantą bei koreliuotų su kitais regresoriais. Kas sukelia įvertinių poslinkius. Jei atlikus papildomą regresiją testuojamo kintamojo p-reikšmė padidėjo, tai reiškia yra praleistas reikšmingas kintamasis ir testo kintamojo parametras buvo paslinktas neigiamai. Jei p-reikšmė sumažėjo - parametras buvo paslinktas teigiamai.\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Anksčiau minėtai regresijai atlikus dvigubą atranką galima teigti, kad visi pirmame žingsnyje atrinkti makroekonominiai rodikliai reikšmingai veikia Lietuvos akcijų rinkos grąžas. Tačiau pagrindinis modelis greičausiai neįtraukia svarbių kintamųjų, kuriuos atmetus daroma klaidinga reikšmingumo interpretacija. Pataisyti modelio įvertiniai ir jų reikšmingumai.\n\n\n\\newpage\n\n\n# Premijinių grąžų prognozavimas\n\n## Prognozuojantis modelis\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Tarkime *t* žymi mėnesį, kurį žinome vėliausiai iš 169 mėnesių ir iš turimų *t* mėnesių prognozuojamas *t+1* mėnesio premijinės grąžos. Surinkta iš viso 170 mėnesių duomenys.\nVertinant kito mėnesio OMX Vilniaus premijines grąžas, t.y. laiko momentui *t+1*, modelyje kintamųjų duomenys gali būti vėliausias *t* laiko momento, nes turi būti žinomi rodiklių duomenys *t* laiko momentu. Dėl paprastumo premijinę grąžą žymėsime $R(t+1) := {Y}_{t+1}$ Duomenų pavėlinimus renkantis pagal kryžminę koreliaciją (visi aiškinantieji rodikliai turi būti ankstesni negu prognozuojamų premijinių grąžų mėnesis) ir atrenkami kintamieji pagal žingsninę regresiją minimizuojant AIC. Tokiu algoritmu gaunamas prognozavimo modelis:\n$R(t+1) = {\\beta}_0 + {SP350}_t {\\beta}_1 + \\textit{mažmeninės prekybos pasitikėjimas}_{t-3} {\\beta}_2 + \\textit{paslaugų sektoriaus pasitikėjimas}_{t-12} {\\beta}_3 + \\textit{pramonės pasitikėjimas}_t {\\beta}_4 + \\textit{užsakymų lūkesčiai}_{t-10} {\\beta}_5 + \\textit{mažmeninė prekyba}_{t-1} {\\beta}_6 + \\textit{gamintojų kainų lygis}_{t-9} {\\beta}_7 + \\textit{EUR/DOL kursas}_{t-2} {\\beta}_8 + {u}_{t+1}$\n\n```{r, warning=F, include=F, message=FALSE, echo=FALSE}\n#kaip gaunamamas prognozuojantis modelis algoritmas\ndata4=data3[,c(\"Data\",\"OMX\",\"SP350\",\"kk\",\"dll\",\"nedarbas\",\"mhope\",\"phope\",\"pramhope\",\"shope\",\"ul\",\"vhope\",\"vp\",\"mp\" ,\"gkl\",\"ip\",\"kursas\")]\n\nFind_Max_CCF<- function(a,b,i){\n  d <- ccf(a, b, plot = FALSE,na.action = na.pass)\n  d = d[1:19] \n  cor = d$acf[,,1]\n  lag = d$lag[,,1]\n  res = data.frame(cor,lag)\n  if(i %in% c(6,15)){                       # mažas apribojimas: gamintojų kainų lygis ir nedarbas gali turėti tik neigiamą koreliaciją, o visi kiti tik teigiamą koreliaciją (pagal logiką)\n    res_max = res[which.min(res$cor),]\n  }\n  else{ res_max = res[which.max(res$cor),]}\n  return(res_max)\n} \n\nlagdata=data.frame()\nfor (u in 3:length(data4[1,])){\n  ccfvalues <- Find_Max_CCF(data4$OMX,data4[,u],u)\n  if(u==3){lagdata=ccfvalues}\n  else{lagdata=rbind(lagdata,ccfvalues)}\n  }\n\n  mod=lm(OMX~lag(SP350,lagdata[1,2])+lag(kk,lagdata[2,2])+lag(dll,lagdata[3,2])+lag(nedarbas,lagdata[4,2])+lag(mhope,lagdata[5,2])+lag(phope,lagdata[6,2])+lag(pramhope,lagdata[7,2])+lag(shope,lagdata[8,2])+lag(ul,lagdata[9,2])+lag(vhope,lagdata[10,2])+lag(vp,lagdata[11,2])+lag(mp,lagdata[12,2])+lag(gkl,lagdata[13,2])+lag(ip,lagdata[14,2])+lag(kursas,lagdata[15,2]),data=data4)\n\nmodprog=stepAIC(mod, direction=\"both\")\nformula(modprog)\n\n```\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; k-uoju mėnesiu vadinsime mėnesį nuo kurio pradedama prognozuoti kito mėnesio premijinė grąža, t. y. turint *k*-tuosius mėnesius įvertinamas prognozuojantis modelis OLS metodu ir prognozuojamas *k+1* mėnesis, tada turint *k+1* mėnesius vėl naujai įvertinamas prognozuojantis modelis OLS metodu ir prognozuojamas *k+2* mėnesio premijinė grąža ir t.t. iki 169-to mėnesio, kai iš turimų 169 mėnesių įvertinamas prognozuojantis modelis ir prognozuojamas paskutinio turimo mėnesio premijinė grąža. Iš turimų $t = \\overline{k,k+1,...,169}$ prognozuojama atitinkamai $t = \\overline{k+1,k+2,...,170}$ mėnesiai.\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Prognozuojamų ir realių rizikų premijinės OMX Vilniaus indekso grąžos:\n\n```{r, warning=F, echo=FALSE, dev='quartz_pdf'}\nprogn=numeric()\n for(i in 12:168){\n   modelis = lm(OMX ~ lag(SP350,1)  + lag(phope,12)  + lag(ul,10)+lag(mhope, 3)+ lag(gkl, 9)+  lag(ip,11)+lag(kursas,1),data=data3)  \n   a=predict(modelis, data3[1:i+1,])\n   progn=append(progn,a[length(a)])\n   \n}\n\n\nprogn=as.numeric(progn)\na=cbind(progn,data3$OMX[13:length(data3$OMX)])\na=data.frame(a)\n\nmenesiai=c(1:158)\na=cbind(menesiai,a)\nrownames(a)=NULL\ncolnames(a)=c(\"menesiai\",\"progn\", \"reali\")\nakc = melt(a, id=c(\"menesiai\"))\nggplot(akc) + geom_line(aes(x=menesiai, y=value*100, colour=variable)) +\n  scale_colour_manual(values=c(1:2))+ylab(\"% pokytis\")+\n  guides(col=guide_legend(title=\"Kintamieji\")) +\n  geom_hline(yintercept = 2) + geom_hline(yintercept =-2) +\n  ggtitle(\"Prognozuojamų ir realių rizikų premijinės OMX Vilniaus indekso grąžos\")\n\n```\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Grafike parodomos realios ir prognozuojančio modelio premijinės grąžos. Prognozuojamos grąžos tuo metu turima imtimi (prognozuojama *t+1*-ojo mėnesio grąža, kai turimi duomenys yra iš *t* mėnesių). Linijos eina ties -2% ir +2 % riba, šios ribos svarbios, nes vėliau apibrėšta strategija, pagal kurią atliekami veiksmai, jei prognozuojamos grąžos yra arba žemiau -2% riba, arba aukščiau +2% riba. \n\n## Strategijų aprašas\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Prognozuojančio modelio praktiniam naudojimui būtina strategija, kuri nustatytų kaip pasinaudoti prognozuojamomis premijinėmis grąžomis. Kadangi mes norėtume kuo pelningiau ir kuo mažesne rizika investuoti, bus investuojama tik tada, kai prognozuojama grąža viršija subjektyviai užsibrėžtą ribą. Kuo didesnė riba užbrėžta, tuo mažiau investavimo galimybių aptinkama, tačiau kuo mažesnė riba, tuo mažesnė grąža per sandorį. Apibrėžiamos investavimo strategijos žemiau.\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Strategijos: \n\n1) perkamas portfelis, reprezentuojantis OMX Vilnius indeksą, *t* laiko momentu, jei *t+1* laiko momentu prognozuojama didesnė negu 2% premijinė grąža ir portfelis yra parduodamas kitą mėnesį, kai jau žinoma premijinė grąža ir matomas investavimo rezultatas.\nTaigi jei $\\widehat{R(t+1)}>2$, perkamas portfelis, lygiai toks pat kaip OMX Vilnius indeksas, ir fiksuojam mėnesio grąžą.\n\n2) Kad išnaudoti prognozuojamą kritimą, pasiskolinamas ir parduodamas (angl. short sell) portfelis, sudarytas pagal OMX Vilniaus indeksą. Kitaip tariant, jei $\\widehat{R(t+1)}<2$, tai pasiskolinamas ir parduodamas (angl. short sell) portfelis, sudarytas pagal OMX Vilniaus indeksą, ir kitą mėnesį atperkamas portfelis ir grąžinama skola, fiksuojama sandorio grąža. Šiuo atveju grąža bus teigiama jei bus akcijų indekso kritimas.\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Taigi, turint *t* mėnesių duomenis, gaunamas įvertis $\\widehat{R(t+1)}$ pagal įvertinį:\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$R(t+1) = {\\beta}_0 + {SP350}_t {\\beta}_1 + \\textit{mažmeninės prekybos pasitikėjimas}_{t-3} {\\beta}_2 + \\textit{paslaugų sektoriaus pasitikėjimas}_{t-12} {\\beta}_3 + \\textit{pramonės pasitikėjimas}_t {\\beta}_4 + \\textit{užsakymų lūkesčiai}_{t-10} {\\beta}_5 + \\textit{mažmeninė prekyba}_{t-1} {\\beta}_6 + \\textit{gamintojų kainų lygis}_{t-9} {\\beta}_7 + \\textit{EUR/DOL kursas}_{t-2} {\\beta}_8 + {u}_{t+1}.$\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Kai $\\widehat{R(t+1)} > 2$, bus perkama ir po mėnesio parduodama. Kita strategija: kai $\\widehat{R(t+1)} < 2$ bus pasiskolinama ir parduodama, kitą mėnesį atperkamos ir grąžinamos akcijos, fiksuojama grąža (mėnesio short sell'as).\n\n## Prognozuojančio modelio testavimas\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Strategijos pratestuojamos su atsitiktiniu investavimu, kuris yra generuotas Monte Carlo metodu. Atsitiktinio investavimo sąlygos tokios pačios: tiek pat pirkimų kaip ir su strategija, jei buvo galimybė tą mėnesį investuoti su strategija, tai su atsitiktiniu investavimu taip pat. Galimi mokesčiai į skaičiavimus neįtraukiami.\n\n```{r, message=FALSE, echo=FALSE, include=FALSE}\n\nformula_prog=OMX ~ lag(SP350, 1) + lag(mhope, 3) + lag(phope,12) + lag(ul, 10) + lag(gkl, 9) + lag(ip,4) + lag(kursas, 2)     # kai lagas turi buti\n\n#kodas parasytas tikrinimui su atsitiktiniu pirkimu, sioje dalyje panaikinsime atsitiktinius pirkimus ir parodysime tik strategiju pirkimus ir pelnus \n\ngen=function(pradzia,pirkti){\nb=sample(pradzia:169,length(pirkti),replace=F)\nreturn(sum(data3[b,\"OMX\"]))\n}\n\nvalidation=function(pradzia,formula_prog){\n  pirkti=numeric()\n  parduoti=numeric()\n    for(i in pradzia:168){\n      modprog <- lm( formula_prog, data = data3[1:i,])\n      a=predict(modprog, data3[1:i+1,])\n      a=a[length(a)]\n      if(matrix(a)[1]>0.02){pirkti=append(pirkti,i+1)}\n      if(matrix(a)[1]<0.02){parduoti=append(parduoti,i+1)}                     \n    }\n  graza=sum(data3[pirkti,\"OMX\"])\n  grazapard=sum(data3[parduoti,\"OMX\"])*(-1)\n  random=replicate(10000,gen(pradzia,pirkti))\n  random2=replicate(10000,gen(pradzia,parduoti))*(-1)\n  p=mean(random<graza)\n  p2=mean(random2<grazapard)\n  vidurkis_random = mean(random)\n  vidurkis_random2 = mean(random2)\n  if(p==0){p=\"nebuvo pirkimu\"}\n  else{\n    p=append(p,graza*100)\n    p=append(p,vidurkis_random*100)\n    p=append(p,graza*100/length(pirkti))\n    p=append(p,pradzia)\n    p[c(1:5)]=p[c(5,2,3,1,4)]\n    p=append(p,length(pirkti))\n    p=append(p,grazapard*100)\n    p=append(p,vidurkis_random2*100)\n    p=append(p,p2)\n    p=append(p,grazapard*100/length(parduoti))\n    p=append(p,length(parduoti))\n    p=round(p,3)\n    }\n  return(p)                               \n}\n\n\nlentele=data.frame()\nfor(i in c(30,70,100,130,140,150)){\n  lentele=rbind(lentele,validation(i,formula_prog))\n}\n\ncolnames(lentele) = c(\"pradinės imties dydis\",\"pirkimo strategijos grąža %\",\"vidutinė atsitiktinio pirkimo grąža %\",\"tikimybė, kad geriau uz atsiktiktinį pirkimą\",\"vidutinė grąža per pirkimą\",\"pirkimų skaičius\",\"pardavimo strategijos grąžą %\",\"vidutinė atsitiktinio pardavimo grąža %\",\"tikimybė, kad geriau uz atsiktiktinį pardavimą\",\"vidutinė grąža per pardavimą\",\"pardavimų skaičius\")\n\n```\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Pagal griežčiausios efektyviosios rinkos hipetezę jokia viešai prieinama informacija nepadidins investavimo pelningumo. Taigi pagal tokia prielaidą strategijos turėtų nesiskirti nuo atsitiktinio investavimo. Lentelėje žemiau pateikiami simuliacijos rezultatai, kokią premijinę grąžą sugeneravo strategijų naudojimai ir kokią vidutiniškai grąžą generuoja atsitiktinis investavimas į portfelį, sudarytą pagal OMX Vilnius indeksą. Apskaičiuojamas atsitiktinio investavimo grąžų skirtinys generuojant atsitiktinius investavimus Monte Carlo metodu. Tai leidžia apskaičiuoti apytikslę tikimybę, kad investavimas su strategija geriau nei su atsitiktinis investavimas.\n\n\\newpage\n\n```{r, echo=FALSE}\npander::pander(lentele, split.cell = 80, split.table = Inf, caption=\"Strategijų tikrinimas\")\n```\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Pradinis imties dydis arba kaip anksčiau buvo vadintas *k*-tuoju mėnesiu strategijos apraše, yra mėnesis nuo kurio pradedama naudotis strategijomis. Svarbias rodiklis yra tikimybė, kad geriau už atsitiktinį pirkimą arba pardavimą, nes jis parodo kokia dalis Monte Carlo metodu generuotų atsitiktinių pirkimų arba pardavivimų buvo aplenktos su strategijomis. Jei yra aplenkiama 0,5 dalis generuotų atsitiktinių pirkimų ar pardavimų, tai reikštų geresnį nei vidutinis investavimas rezultatą.\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Pagal simuliaciją, naudojant praeities duomenis, kai pradinė imtis yra 30, visos atsitiktinių investavimų situacijos yra aplenktos investavimu su strategijomis. Tai reiškia, jei šis prognozuojantis modelis būtų turėtas 2005 metais ir būtų įvertinami tik modelio koeficientai iš turimų duomenų, tai su šiomis strategijomis būtų beveik garantuotai didesnė grąža nei atsitiktinai investavus. Tačiau 2005 metais galbūt nebūtų išvestas toks prognozuojantis modelis iš tuo metu turimais duomenimis. Gal būtų modelis su kitais pavėlinimais ir galbūt naudojami kiti makroekonominiai rodikliai, kas lemtų ne tokį geresnį rezultatą prieš atsitiktinį investavimą. Todėl reikia tikrinti algoritminį investavimą, ar sudarytas modelis pagal algoritmą iš turimų duomenų, gali būti naudingas investuojant.\n\n##Tikrinamas algoritminis investavimas\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Nėra nustatyto modelio, kiekvienam mėnesiui didėjant gali keistis modelis ir modelio koeficientai. Modelis sudaromas pagal tokį algoritmą: nustatomas geriausias vėlinimas kiekvienam rodikliui pagal kryžminę koreliaciją, reikšmingiausi kintamieji atrinkami pagal žingsninę regresiją mažinant AIC. Tikrinamas algoritmu gautas prognozuojantis modelis investuojant anksčiau aprašytomis strategijomis.\n\n```{r,include=F}\n\ngen=function(pradzia,pirkti){\nb=sample(pradzia:169,length(pirkti),replace=F)\nreturn(sum(data4[b,\"OMX\"]))\n}\n\n\nFind_Max_CCF<- function(a,b,i){\n d <- ccf(a, b, plot = FALSE,na.action = na.pass)\n d = d[1:19] \n cor = d$acf[,,1]\n lag = d$lag[,,1]\n res = data.frame(cor,lag)\n if(i %in% c(6,15)){\n res_max = res[which.min(res$cor),]\n }\n else{ res_max = res[which.max(res$cor),]}\n return(res_max)\n} \n\nvalidation=function(pradzia){\n  pirkti=numeric()\n  parduoti=numeric()\n    for(i in pradzia:169){\n      \n      lagdata=data.frame()\n      for (u in 3:length(data4[1,])){\n        ccfvalues <- Find_Max_CCF(data4$OMX,data4[1:i,u],u)\n          if(u==3){lagdata=ccfvalues}\n          else{lagdata=rbind(lagdata,ccfvalues)}\n      }\n\n      mod=lm(OMX~lag(SP350,lagdata[1,2])+lag(kk,lagdata[2,2])+lag(dll,lagdata[3,2])+lag(nedarbas,lagdata[4,2])+lag(mhope,lagdata[5,2])+lag(phope,lagdata[6,2])+lag(pramhope,lagdata[7,2])+lag(shope,lagdata[8,2])+lag(ul,lagdata[9,2])+lag(vhope,lagdata[10,2])+lag(vp,lagdata[11,2])+lag(mp,lagdata[12,2])+lag(gkl,lagdata[13,2])+lag(ip,lagdata[14,2])+lag(kursas,lagdata[15,2]),data=data4[1:i,])\n      \n      \n      modprog=stepAIC(mod, direction=\"both\")\n      a=predict(modprog, data4[1:i+1,])\n      a=a[length(a)]\n      if(matrix(a)[1]>0.02){pirkti=append(pirkti,i+1)}\n      if(matrix(a)[1]<0.02){parduoti=append(parduoti,i+1)}\n  }    \n  graza=sum(data4[pirkti,\"OMX\"])\n  grazapard=sum(data3[parduoti,\"OMX\"])*(-1)\n  random=replicate(10000,gen(pradzia,pirkti))\n  random2=replicate(10000,gen(pradzia,parduoti))*(-1)\n  p=mean(random<graza)\n  p2=mean(random2<grazapard)\n  vidurkis_random = mean(random)\n  vidurkis_random2 = mean(random2)\n  if(p==0){p=\"nebuvo pirkimu\"}\n  else{\n    p=append(p,graza*100)\n    p=append(p,vidurkis_random*100)\n    p=append(p,graza*100/length(pirkti))\n    p=append(p,pradzia)\n    p[c(1:5)]=p[c(5,2,3,1,4)]\n    p=append(p,length(pirkti))\n    p=append(p,grazapard*100)\n    p=append(p,vidurkis_random2*100)\n    p=append(p,p2)\n    p=append(p,grazapard*100/length(parduoti))\n    p=append(p,length(parduoti))\n    p=round(p,3)\n    }\n  return(p)                               \n}\n\nlentele2=data.frame()\nfor(i in c(100,110,120,130,140,150,160)){\n  lentele2=rbind(lentele2,validation(i))\n}\n\ncolnames(lentele2) = c(\"pradinės imties dydis\",\"pirkimo strategijos grąža %\",\"vidutinė atsitiktinio pirkimo grąža %\",\"tikimybė, kad geriau už atsiktiktinį pirkimą\",\"pirkimų skaičius\",\"vidutinė grąža per pirkimą\",\"pardavimo strategijos grąžą %\",\"vidutinė atsitiktinio pardavimo grąža %\",\"tikimybė, kad geriau uz atsiktiktinį pardavimą\",\"vidutinė grąža per pardavimą\",\"pardavimų skaičius\")\n\n```\n\nPirma strategija:\n\n```{r,echo=F}\npander::pander(lentele2[,c(\"pradinės imties dydis\",\"pirkimo strategijos grąža %\",\"vidutinė atsitiktinio pirkimo grąža %\",\"tikimybė, kad geriau už atsiktiktinį pirkimą\",\"pirkimų skaičius\",\"vidutinė grąža per pirkimą\")], split.cell = 80, split.table = Inf, caption=\"pirma strategija\")\n```\n\nAntra strategija:\n\n```{r,echo=F}\npander::pander(lentele2[,c(\"pradinės imties dydis\",\"pardavimo strategijos grąžą %\",\"vidutinė atsitiktinio pardavimo grąža %\",\"tikimybė, kad geriau uz atsiktiktinį pardavimą\",\"vidutinė grąža per pardavimą\",\"pardavimų skaičius\")], split.cell = 80, split.table = Inf,caption=\"antra strategija\")\n```\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Makroekonominiai rodikliai dažniausiai leidžia pelningiau investuoti negu atsitiktinai investavus, ypač papididintos rizikos laikotarpiais. \n\n\\newpage\n\n# Išvados\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Naudojant CAPM ir APT idėjas, rasta tiesinė priklausomybė tarp makroekonominių rodiklių pokyčių ir Lietuvos akcijų rinką reprezentuojančio OMX Vilnius indekso pokyčių. Pagal CAPM įtrauktas didesnę rinką reprezentuojantis indeksas S&P 350 Europe. Jo pokyčiai padeda reikšmingai paaiškinti OMX Vilnius indekso pokyčius. Pagal APT įtraukti Lietuvos makroekonominiai rodikliai.\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Sudarytas modelis iš visų turimų kintamųjų. Ankstiniai atrinkti pagal didžiausią kryžminę koreliaciją. Dvigubos atrankos metodu minimizuojant Akaike kriterijų rasti reikšmingi makroekonominiai rodikliai, kurie iš tikrųjų veikia OMX Vilnius indekso pokyčius. Taip pat įvertinti parametrų poslinkiai, pataisyti reikšmingumai. Atradus reikšmingumą sukurtas prognozuojantis modelis gali padėti pelningiau investuoti nei atsitiktinai investuojant. Taigi viešai prieinami makroekonominiai duomenys gali būti panaudoti pelningiau investuojant.\n\n\\newpage\n\n\\begin{thebibliography}{00}\n\\bibitem{rusija}\n  Mauri Paavola. Tests of the Arbitage Pricing Theory using Macroeconomic Variables in the Russian Equity Market. Department of Business Administration Section of Accounting and Finance, 2006.\n\n\\bibitem{brooks}\n  Chris Brooks, Introductory Econometrics for Finance.\n \n \\bibitem{sri_lanka}\n   Prabath Suranga Morawakage. Relationship between Macro – Economic Variables and Stock Market Performance of Colombo Stock Exchange. Lecturer (Probationary) Department of Finance Faculty of Commerce and Management Studies\nUniversity of Kelaniya, 2013.\n \n \\bibitem{indija}\n   Sagarika Mishra. Do Macro - Economic Variables explain Stock - Market Returns? Evidence using a Semi-Parametric Approach. Journal of Asset Management, 2011.\n \n \\bibitem{capm} \n   The Capital Asset Pricing Model: An Aplication of Bivariate Regression Analysis. University of Pennsylvania.\n\n \\bibitem{apt_capm}\n   Aistė Launagaitė, Vertybinių popierių rizikos ir pelningumo modelių įvertinimas. Vilniaus Universitetas, Kauno Humanitarinis Fakultetas, Finansų ir Apskaitos Katedra, 2007.\n \n  \\bibitem{duomenys}\n   \\url{http://ec.europa.eu/eurostat/data/database}\n \n\\end{thebibliography}\n\n\\newpage\n\n\\setcounter{section}{0}\n\\renewcommand\\thesection{\\Alph{section}}\n\n# Priedai:\n\n## Kintamieji\nDarbe naudojami mėnesiniai duomenys nuo 2002 metų birželio iki 2016 metų liepos. Duomenys gauti iš Eurostat ir Europos Centrinio Banko svetainių. Susiduriama su mėnesinių rodiklių trūkumu: BVP, gyventojų pajamos, pinigų paklausa yra ketvirtiniai duomenys. Taip pat žvelgiant pasauliniu mastu, Vilniaus akcijų birža yra smulki, o akcijų likvidumas čia taip pat žemas. Nepaisant šių problemų, buvo rasta koreliacija tarp kai kurių makroekonominių duomenų ir OMX Vilnius indekso grąžų.\n\n* S&P 350 Europe - tai indeksas sudarytas iš 350 didžiausių Europos imonių akcijų.\n* S&P 500 - tai indeksas sudarytas iš 500 didžiausių Amerikos imonių akcijų.\n* Euribor 3 mėnesių - palūkanų norma už kurią Europos bankai skolina pinigus vieni kitiems trijų mėnesių laikotarpiui.\n* Euro ir JAV dolerio valiutos kursas.\n* Nedarbas - darbingų nedirbančių žmonių skaičius 1000 žmonių.\n* Pramonės gamintojų kainos  - matuoja vidutinę kainų raidą, visų produktų bei paslaugų iš pramonės sektoriaus ir parduotų vidinėje rinkoje. Procentinis pokytis nuo praeito mėnesio.\n* Infliacija - 12 mėnesių infliacija apskaičiuota pagal mažmeninės prekybos indeksą.\n* Industrinė produkcija - indeksas matuoja produkcijos kiekį nuo gamybos, kasybos, elektros ir dujų pramonės. Atskaitiniai metai 2010 (2010m. indeksas = 100).\n* Darbo lygio ir užsakymų lūkesčiai - mėnesinės apklausos, teigiamų ir neigiamų atsakymų santykis.\n* Pasitikėjimo indikatoriai - pramonės, mažmeninės prekybos, vartotojų, paslaugų, statybų. Tai yra apklausų teigiamų ir neigiamų atsakymų santykis.\n* Mažmeninė prekyba, išskyrus variklinių transporto priemonių ir motociklų prekybą- indeksuotas rodiklis (2010m indeksas = 100).\n\n## Paklaidų ir liekanų testai\n\n```{r, message=FALSE, echo=FALSE}\nphomo<-ncvTest(modelis)\n# Jei p-value > 0.05, tai H0 hipotezė priimama - paklaidos homoskedastiškos.\n```\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Paklaidų homoskedastiškumo testas su H0 hipoteze, kad paklaidos yra homoskedastiškos. Testo p-reikšmė mažesnė nei 0,05. H0 hipotezė atmetama, paklaidų dispersija nėra konstanta.\n\n```{r, message=FALSE, echo=FALSE}\naut<-durbinWatsonTest(modelis)\n# Jei p-value > 0.05 - paklaidos nėra autokoreliuotos.\n```\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Tikrinama ar liekanos nėa autokoreliuotos. H0 hipotezė - paklaidos nėra autokoreliuotos. Testo p-reikšmė didesnė nei 0,05. H0 hipotezės negalime atmesti, liekanos nėra autokoreliuotos.\n\n```{r, message=FALSE, echo=FALSE}\nbalt<-Box.test(modelis$res, fitdf=0, type=\"Lj\")\n# Jeip-value >0.05, vadinasi H0 neatmetama. Galima teigti, kad liekanos yra baltasis triukšmas.\n```\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Tikrinama ar liekanos yra baltasis triukšmas. H0 : liekanos yra baltasis triukšmas. Testo p-reikšmė didesnė nei 0,05, negalime atmesti H0. Liekanos yra baltasis triukšmas.\n\n```{r, message=FALSE, echo=FALSE}\nnorm<-shapiro.test(modelis$residuals)\n# Jei p-value > 0.05 - liekanos yra normalios\n```\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Tikrinamas paklaidų normalumas. H0: liekanos yra normaliai pasiskirstę. Testo p-reikšmė mažesnė nei 0,05. H0 hipotezė atmetama, liekanos nėra normaliai pasiskirstę.\n\n## Duomenų vizualizacija\n\n```{r, message=FALSE, echo=FALSE}\npanel.hist <- function(x, ...)    #ši funkcija reikalinga grafikų lentelei išbrėžti (histogramos pateikimui)                        \n{\n  usr <- par(\"usr\"); on.exit(par(usr))\n  par(usr = c(usr[1:2], 0, 1.5) )\n  h <- hist(x, plot = FALSE)\n  breaks <- h$breaks; nB <- length(breaks)\n  y <- h$counts; y <- y/max(y)\n  rect(breaks[-nB], 0, breaks[-1], y, col = \"cyan\", ...)\n}\n\npanel.cor2 <- function(x, y, digits=2, cex.cor)\n{\n  usr <- par(\"usr\"); on.exit(par(usr))\n  par(usr = c(0, 1, 0, 1))\n  r <- abs(cor(x, y))\n  txt <- format(c(r, 0.123456789), digits=digits)[1]\n  test <- cor.test(x,y)\n  Signif <- ifelse(round(test$p.value,3)<0.001,\"p<0.001\",paste(\"p=\",round(test$p.value,3)))  \n  text(0.5, 0.25, paste(\"r=\",txt))\n  text(.5, .75, Signif)\n}\npanel.cor <- function(x, y, digits = 2, prefix = \"\", cex.cor,...)    #ši funkcija reikalinga grafikų lentelei\n    #išbrėžti (koreliacijos koeficiento radimui)\n{\n  usr <- par(\"usr\"); on.exit(par(usr))\n  par(usr = c(0, 1, 0, 1))\n  r <- abs(cor(x, y))\n  txt <- format(c(r, 0.123456789), digits = digits)[1]\n  txt <- paste0(prefix, txt)\n  if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)\n  text(0.5, 0.5, txt, cex = 3)\n}\n```\n\n<br>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; S&P350 Europe indeksas yra įtraukiamas, remiantis CAPM. Galima teigti, jog OMX Vilniaus indeksas yra stipriai susijęs su S&P350 indeksu ir šis indeksas gerai apibūdina sisteminę riziką kaip ir kitoms Europos rinkoje esančiomis akcijoms. \nPagal CAPM turėtų matytis koreliacija tarp OMX Vilniaus indekso ir S&P 350 Europe. Koreliacija aiškiai matoma grafike. Tai patvirtina, jog reikėtų bandyti įtrauki Europos indeksą aiškinant grąžų premijos riziką.\n\n```{r, message=FALSE, echo=FALSE, warning=F, dev='quartz_pdf'}\nakc = melt(data3[,c(\"OMX\",\"SP350\",\"SP500\",\"Data\")], id=c(\"Data\"))\nggplot(akc) + geom_line(aes(x=Data, y=value, colour=variable)) +\n  scale_colour_manual(values=c(1:4))+ylab(\"% pokytis\")+\n  guides(col=guide_legend(title=\"Kintamieji\"))+\n  ggtitle(\"Akcijų indeksų mėnesiniai procentiniai pokyčiai\")\n```\n\n\\newpage\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Kintamųjų koreliacija su OMX Vilnius. r - koreliacijos koeficientas, p - koreliacijos reikšmingumas:\n\n```{r, message=FALSE, echo=FALSE}\npairs(data3[,c(\"OMX\",\"SP350\",\"nedarbas\",\"kursas\")],upper.panel=panel.smooth,diag.panel=panel.hist, lower.panel=panel.cor2)\n```\n\n```{r, message=FALSE, echo=FALSE}\npairs(data3[,c(\"OMX\",\"mhope\",\"phope\",\"ul\",\"gkl\",\"ip\")],upper.panel=panel.smooth,diag.panel=panel.hist, lower.panel=panel.cor2)\n```\n\n* Kaip ir buvo tikėtasi tarp kintamųjų ir OMX Vilnius rasta nestipri koreliacija, tačiau reikšminga. \n\n\n",
    "created" : 1492008250656.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "153488723",
    "id" : "1CBD0AEC",
    "lastKnownWriteTime" : 1481126893,
    "last_content_update" : 1481126893,
    "path" : "~/Documents/Ekonometrija/3 kursas 1 semestras/kursiniam/galutinis/galutinis.Rmd",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}